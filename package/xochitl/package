#!/usr/bin/env bash
# Copyright (c) 2021 The Toltec Contributors
# SPDX-License-Identifier: MIT

pkgnames=(xochitl)
pkgdesc="Read documents and take notes"
url=https://remarkable.com
pkgver=0.0.0-12
timestamp=2022-01-05T18:17:52Z
section="readers"
maintainer="Matt√©o Delabre <spam@delab.re>"
license=MIT
installdepends=(findutils remarkable-splash)

source=(
    xochitl
    xochitl.png
    xochitl.draft
    xochitl.oxide
    toltec-wrapper.conf
    remarkable-shutdown-override.conf
    remarkable-reboot-override.conf
    env-readme
)
sha256sums=(
    SKIP
    SKIP
    SKIP
    SKIP
    SKIP
    SKIP
    SKIP
    SKIP
)

package() {
    install -d "$pkgdir"/opt/etc/draft \
        "$pkgdir"/opt/etc/draft/icons \
        "$pkgdir"/opt/etc/xochitl.env.d \
        "$pkgdir"/etc/systemd/system/xochitl.service.d \
        "$pkgdir"/etc/systemd/system/remarkable-shutdown.service.d \
        "$pkgdir"/etc/systemd/system/remarkable-reboot.service.d
    install -D -m 755 -t "$pkgdir"/opt/bin "$srcdir"/xochitl
    install -D -m 644 "$srcdir"/env-readme "$pkgdir"/opt/etc/xochitl.env.d/README
    install -D -m 644 -t "$pkgdir"/opt/etc/draft "$srcdir"/xochitl.draft
    install -D -m 644 -t "$pkgdir"/opt/etc/draft/icons "$srcdir"/xochitl.png
    install -D -m 644 -t "$pkgdir"/opt/usr/share/applications "$srcdir"/xochitl.oxide
    install -D -m 644 -t "$pkgdir"/etc/systemd/system/xochitl.service.d "$srcdir"/toltec-wrapper.conf
    install -D -m 644 -t "$pkgdir"/etc/systemd/system/remarkable-shutdown.service.d "$srcdir"/remarkable-shutdown-override.conf
    install -D -m 644 -t "$pkgdir"/etc/systemd/system/remarkable-reboot.service.d "$srcdir"/remarkable-reboot-override.conf
}

configure() {
    systemctl daemon-reload
}

postremove() {
    systemctl daemon-reload
}
